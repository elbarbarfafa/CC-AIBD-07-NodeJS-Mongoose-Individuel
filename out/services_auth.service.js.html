<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/auth.service.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/auth.service.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const jwt = require('jsonwebtoken');
const Internaute = require('../models/internaute.model');
const InternauteDto = require('../dto/internaute.dto');

class AuthService {
  /**
   * Permet l'inscription d'un utilisateur.
   * @param {*} userData - Objet contenant les données de l'utilisateur.
   * @param {string} userData.email - L'email de l'utilisateur.
   * @param {string} userData.nom - Le nom de l'utilisateur.
   * @param {string} userData.prenom - Le prénom de l'utilisateur.
   * @param {string} userData.motDePasse - Le mot de passe de l'utilisateur.
   * @param {number} userData.anneeNaissance - L'année de naissance de l'utilisateur.
   * @throws {Error} Si l'email est déjà utilisé.
   * @returns {Promise&lt;{token: string, internaute: InternauteDto}>} L'objet contenant le token JWT et les informations de l'internaute.
   */
  async register(userData) {
    const { email, nom, prenom, motDePasse, anneeNaissance } = userData;

    const existingInternaute = await Internaute.findOne({ email });
    if (existingInternaute) {
      throw new Error('Cet email est déjà utilisé');
    }

    const internaute = new Internaute({ email, nom, prenom, motDePasse, anneeNaissance });
    await internaute.save();

    // gération du token JWT pour l'utilisateur
    const token = this.generateToken(internaute._id);
    return { token, internaute: InternauteDto.toDto(internaute) };
  }

  /**
   * Permet à un internaute de se connecter.
   * @param {string} email - L'email de l'internaute.
   * @param {string} motDePasse - Le mot de passe de l'internaute.
   * @throws {Error} Si les identifiants sont invalides.
   * @returns  {Promise&lt;{token: string, internaute: InternauteDto}>} L'objet contenant le token JWT et les informations de l'internaute.
   */
  async login(email, motDePasse) {
    const internaute = await Internaute.findOne({ email });
    if (!internaute) {
      throw new Error('Identifiants invalides');
    }

    const isMatch = await internaute.comparePassword(motDePasse);
    if (!isMatch) {
      throw new Error('Identifiants invalides');
    }

    const token = this.generateToken(internaute._id);
    return { token, internaute: InternauteDto.toDto(internaute) };
  }

  /**
   * Permet de générer un token JWT contenant l'ID de l'utilisateur.
   * @param {string} userId - L'ID de l'utilisateur. 
   * @returns {string} Le token JWT généré.
   */
  generateToken(userId) {
    return jwt.sign({ id: userId }, process.env.JWT_SECRET, { expiresIn: '7d' });
  }

  /**
   * Récupère le profil de l'utilisateur connecté.
   * @param {string} userId Identifiant de l'utilisateur pour récupérer son profil.
   * @returns {Promise&lt;InternauteDto|null>} L'objet contenant les informations de l'internaute ou null si non trouvé.
   */
  async getProfile(userId) {
    const internaute = await Internaute.findById(userId);
    return internaute ? InternauteDto.toDto(internaute) : null;
  }
}

module.exports = new AuthService();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ArtisteController.html">ArtisteController</a></li><li><a href="ArtisteService.html">ArtisteService</a></li><li><a href="AuthController.html">AuthController</a></li><li><a href="FilmController.html">FilmController</a></li><li><a href="FilmService.html">FilmService</a></li><li><a href="InternauteController.html">InternauteController</a></li><li><a href="InternauteService.html">InternauteService</a></li><li><a href="NoteController.html">NoteController</a></li><li><a href="NoteService.html">NoteService</a></li><li><a href="PaysController.html">PaysController</a></li><li><a href="PaysService.html">PaysService</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sat Aug 02 2025 12:58:27 GMT+0200 (heure d’été d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
